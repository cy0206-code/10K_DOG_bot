# 10K DOG - Jarvis Bot 🤖

這是一個專為 Telegram 社群設計的多功能管理機器人。核心開發目標是提供高效的 **連結/廣告過濾**、**多話題（Topics）授權管理** 以及 **直覺的後台管理面板**。

## 🌟 核心特色

* **雲端存儲 (GitHub Gist)**：捨棄傳統資料庫，使用 Gist API 實現資料持久化，並將「核心設定 (Core)」與「高頻數據 (Runtime)」分離，確保效能與穩定性。
* **智能廣告過濾**：自動識別連結與特定廣告關鍵字，實施「警告 -> 禁言 -> 踢出/封鎖」三段式懲處。
* **話題授權系統**：完美支援 Telegram 論壇模式，管理員可針對特定話題（Thread）開啟或關閉機器人功能。
* **互動式管理面板**：管理員可透過私訊，以圖形化按鈕輕鬆設定群組參數、查看日誌或管理白名單。
* **Premium 特色功能**：支援提取 Telegram Premium 專屬表情符號的 `custom_emoji_id`。

---

## 🛠️ 環境變數設定 (ENV)

部署此機器人前，請確保已設定以下環境變數：

| 變數名稱 | 說明 |
| :--- | :--- |
| `BOT_TOKEN` | Telegram Bot API Token |
| `GIST_TOKEN` | 具備 Gist 讀寫權限的 GitHub Personal Access Token |
| `GIST_ID_CORE` | 用於存儲管理員、授權話題、群組設定的 Gist ID |
| `GIST_ID_RT_JARVIS` | 用於存儲違規紀錄、操作日誌的 Gist ID |
| `DATA_TTL_SEC` | 資料緩存過期時間 (預設 45s) |
| `SAVE_DEBOUNCE_SEC` | 資料寫回 Gist 的延遲時間 (預設 2.5s，防止頻繁請求) |

---

## 📋 指令說明

### 👤 一般用戶指令
* `/start` - 開啟互動式主選單。
* `/ca` - 查看代幣合約地址。
* `/buy` - 獲取購買教學連結。
* `/social_media` - 查看官方社交媒體。
* `/vote` - 獲取每日投票衝熱度連結。

### 👑 群組管理指令 (僅限管理員)
* `/admin_add_jarvis` - 在當前話題啟用 Jarvis 功能。
* `/admin_remove_jarvis` - 在當前話題停用 Jarvis 功能。
* `/admin_add_wl` (需回覆訊息) - 將該用戶加入連結白名單。
* `/admin_remove_wl` (需回覆訊息) - 將該用戶移出白名單。

### 🔐 私訊管理面板 (僅限管理員)
管理員在私訊機器人時發送 `/admin`，可進入後台面板：
* **管理員設定**：新增/移除管理員、查詢用戶 UID。
* **群組設定**：切換連結過濾開關、設定禁言天數、決定第三次違規是踢出 (Kick) 還是封鎖 (Ban)。
* **操作紀錄**：查看最近 12 筆管理操作日誌。

---

## 🛡️ 廣告/連結過濾機制

機器人會自動偵測非白名單用戶發送的連結或特定關鍵字（如：*內部群、跟單、免fei* 等），並依據次數進行處置：

1.  **第一次違規**：刪除訊息 + 警告通知。
2.  **第二次違規**：刪除訊息 + 禁言 (預設 1 天)。
3.  **第三次違規**：刪除訊息 + 踢出群組/封鎖。

---

## 🚀 部署指南

1.  安裝相依套件：
    ```bash
    pip install flask requests pytz
    ```
2.  執行機器人：
    ```bash
    python bot.py
    ```
3.  設定 Webhook：
    造訪 `https://你的網址/set_tg_webhook` 即可自動與 Telegram 完成連動。

---

**💡 注意事項**：
* 機器人需具備「刪除訊息」與「管理用戶」的群組權限才能正常工作。
* 所有時間戳記均以 `Asia/Taipei` (UTC+8) 為準。
